From fc864a26b89fad9bd2ea3a457844020911657c91 Mon Sep 17 00:00:00 2001
From: Caedmon Judd <caedmon@statebuilt.com>
Date: Mon, 24 Oct 2011 16:35:04 -0500
Subject: [PATCH 21/55] Notes work

---
 app/controllers/notes_controller.rb       |    2 +-
 app/views/notes/index.html.haml           |    2 +-
 features/notes.feature                    |    6 +-
 fixtures/vcr/cuke/cucumber_tags/bible.yml |   63 +++++++++++++++++++++++++++++
 4 files changed, 68 insertions(+), 5 deletions(-)

diff --git a/app/controllers/notes_controller.rb b/app/controllers/notes_controller.rb
index 941241c..87a9c9f 100644
--- a/app/controllers/notes_controller.rb
+++ b/app/controllers/notes_controller.rb
@@ -47,7 +47,7 @@ class NotesController < ApplicationController
   
   def destroy
     @note = Note.find(params[:id], current_auth)
-debugger    
+    
     if @note.destroy
       redirect_to '/'
     else
diff --git a/app/views/notes/index.html.haml b/app/views/notes/index.html.haml
index 7f066ac..683f4d6 100644
--- a/app/views/notes/index.html.haml
+++ b/app/views/notes/index.html.haml
@@ -2,7 +2,7 @@
   %h1= "My Notes"
   - @notes.each do |note|
     %div{id: note.id}
-      %div{class: "title"}= link_to note.title, edit_note_path(note.id)
+      %div{class: "title"}= link_to note.title, note_path(note.id)
       %div{class: "content"}= note.content_text
       %div{class: "version"}= note.version
       %div{class: "reference"}= references_breakout(note.reference)
diff --git a/features/notes.feature b/features/notes.feature
index 6ae61d2..860bd8a 100644
--- a/features/notes.feature
+++ b/features/notes.feature
@@ -44,11 +44,11 @@ Feature: Notes view
     | Author    | Title           | Content                 | References  | Status  |
     | testuser  | Public Note     | Public Content          | gen.1.1.kjv | Public  |
     And I am logged in as "testuser" with password "tenders" 
-    When I go to the notes index page for user "testuser" 
+    When I go to the notes index page
     Then I should see a link to "Public Note" 
     When I follow "Public Note" 
-    Then I should see a link to "Delete this note" 
-    When I follow "Delete this note" 
+    Then I should see a link to "delete this note" 
+    When I follow "delete this note" 
     # And confirm it somehow
     Then I should be on the notes index page for user "testuser" 
     And I should not see "Public Note"
diff --git a/fixtures/vcr/cuke/cucumber_tags/bible.yml b/fixtures/vcr/cuke/cucumber_tags/bible.yml
index b60f076..9c8763f 100644
--- a/fixtures/vcr/cuke/cucumber_tags/bible.yml
+++ b/fixtures/vcr/cuke/cucumber_tags/bible.yml
@@ -842,3 +842,66 @@
     body: ! '{"response":{"code":400,"data":{"errors":[{"key":"notes.content.empty_document","error":"Document
       content cannot be empty"}]},"buildtime":"2011-10-24T20:54:47+00:00"}}'
     http_version: '1.1'
+- !ruby/struct:VCR::HTTPInteraction
+  request: !ruby/struct:VCR::Request
+    method: :post
+    uri: http://testuser:tenders@api.yvdev.com:80/2.3/notes/create.json
+    body: title=A%20Different%20Public%20Note&content=%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%3C!DOCTYPE%20yv-note%20SYSTEM%20%22http%3A%2F%2Fapi.yvdev.com%2Fpub%2Fyvml_1_0.dtd%22%3E%3Cyv-note%3EPublic%20Content%3C%2Fyv-note%3E&language_iso=&reference=Gen.1.1&version=kjv&published=&user_status=public&shared_connections=&token=615ad51b71049e299842f5af14c70cad
+    headers:
+      referer:
+      - http://web.youversion.com
+  response: !ruby/struct:VCR::Response
+    status: !ruby/struct:VCR::ResponseStatus
+      code: 200
+      message: OK
+    headers:
+      server:
+      - nginx/0.7.67
+      date:
+      - Mon, 24 Oct 2011 21:25:49 GMT
+      content-type:
+      - text/plain
+      - text/plain; charset=utf-8
+      transfer-encoding:
+      - chunked
+      connection:
+      - keep-alive
+      vary:
+      - Accept-Encoding
+    body: ! '{"response":{"code":201,"data":{"id":"935799","user_id":"4163177","username":"testuser","user_avatar_url":{"px_24x24":"http:\/\/avatars.youversion.com\/5d9c68c6c50ed3d02a2fcf54f63993b6_24x24.png","px_48x48":"http:\/\/avatars.youversion.com\/5d9c68c6c50ed3d02a2fcf54f63993b6_48x48.png","px_128x128":"http:\/\/avatars.youversion.com\/5d9c68c6c50ed3d02a2fcf54f63993b6_128x128.png","px_512x512":"http:\/\/avatars.youversion.com\/5d9c68c6c50ed3d02a2fcf54f63993b6_512x512.png"},"title":"A
+      Different Public Note","highlight_color":null,"content_yvml":"<?xml version=\"1.0\"
+      encoding=\"utf-8\"?>\n<!DOCTYPE yv-note SYSTEM \"http:\/\/api.yvdev.com\/pub\/yvml_1_0.dtd\">\n<yv-note>Public
+      Content<\/yv-note>","content_html":"Public Content","content_html_android":"Public
+      Content","content_html_ios":"Public Content","content_text":"Public Content","url":"\/notes\/935799\/a-different-public-note","short_url":"http:\/\/dev.read.ly\/n\/3vRX","rich_content":false,"language_iso":null,"rank":"0","reference":[{"osis":"Gen.1.1","human":"Genesis
+      1:1"}],"version":"kjv","created":"2011-10-24 21:25:49+00","published":null,"updated":"2011-10-24
+      21:25:49.107386+00","user_status":"public","system_status":"new"},"buildtime":"2011-10-24T21:25:49+00:00"}}'
+    http_version: '1.1'
+- !ruby/struct:VCR::HTTPInteraction
+  request: !ruby/struct:VCR::Request
+    method: :post
+    uri: http://testuser:tenders@api.yvdev.com:80/2.3/notes/delete.json
+    body: id=935772
+    headers:
+      referer:
+      - http://web.youversion.com
+  response: !ruby/struct:VCR::Response
+    status: !ruby/struct:VCR::ResponseStatus
+      code: 200
+      message: OK
+    headers:
+      server:
+      - nginx/0.7.67
+      date:
+      - Mon, 24 Oct 2011 21:31:05 GMT
+      content-type:
+      - text/plain
+      - text/plain; charset=utf-8
+      transfer-encoding:
+      - chunked
+      connection:
+      - keep-alive
+      vary:
+      - Accept-Encoding
+    body: ! '{"response":{"code":404,"data":{"errors":[{"key":"notes.note.not_found","error":"Note
+      not found"}]},"buildtime":"2011-10-24T21:31:05+00:00"}}'
+    http_version: '1.1'
-- 
1.7.0.4

