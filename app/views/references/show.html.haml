-# Variables necessary for templates and partials to render properly
:ruby
  reference      = @presenter.reference
  version        = @presenter.version
  modal_verse    = @presenter.modal_verse
  @title = "#{reference.human} #{version.title}"

- content_for :additional_meta do
  - if modal_verse.present?
    - deep_link = "youversion://#{@presenter.modal_verse.deep_link_path}"
    %meta{name: "apple-itunes-app",         content: "app-id=282935706, app-argument=#{deep_link}"}
    %meta{name: "twitter:card",             content: "summary"}
    %meta{name: "twitter:url",              content: "#{request.protocol}#{request.host_with_port}#{request.fullpath}"}
    %meta{name: "twitter:title" ,           content: @title}
    %meta{name: "twitter:description",      content: truncate(modal_verse.content(as: :plaintext), length: 200, separator: " ")}
    %meta{name: "twitter:image",            content: "#{url_for(asset_path('Bible-app-icon-english-120x120.png'))}"}
    %meta{name: "twitter:site",             content: "@YouVersion"}
    %meta{name: "twitter:app:name:iphone",  content:"Bible"}
    %meta{name: "twitter:app:id:iphone",    content:"282935706"}
    %meta{name: "twitter:app:url:iphone",   content: deep_link}
    %meta{name: "twitter:app:name:ipad",    content:"Bible"}
    %meta{name: "twitter:app:id:ipad",      content:"282935706"}
    %meta{name: "twitter:app:url:ipad",     content: deep_link}
    %meta{name: "twitter:app:name:googleplay",  content:"Bible"}
    %meta{name: "twitter:app:id:googleplay",    content:"com.sirma.mobile.bible.android"}
    %meta{name: "twitter:app:url:googleplay",   content: deep_link }

  %link{href: "//fonts.googleapis.com/css?family=Fjalla+One&subset=latin,cyrillic-ext,cyrillic,greek-ext,vietnamese,latin-ext", rel: "stylesheet", type: "text/css"}

  - if version.attributes.font
    %style
      = "@font-face { font-family: '#{version.attributes.font.title}'; src: url('#{version.attributes.font.url}#{version.attributes.font.name}.eot?') format('eot'), url('#{version.attributes.font.url}#{version.attributes.font.name}.woff') format('woff'), url('#{version.attributes.font.url}#{version.attributes.font.name}.ttf') format('truetype'); }"
      = ".reader { font-family: '#{version.attributes.font.title}','Helvetica Neue', Arial, 'Liberation Sans', FreeSans, sans-serif }"


- content_for :javascripts do
  = javascript_include_tag "//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-54d2b9d73051838d", :defer => "defer"

  :javascript
    var addthis_config = {
      ui_language: "#{I18n.locale[0..1]}",
      services_exclude : 'print,email,google,favorites',
    }
    addthis_config.data_track_clickback = false;

-# Preload Ruby vars into Angular module so Angular controllers
-#  will have access to this data without having to make
-#  additional XHR calls
-#- content_for :javascripts do
%script<
  != "angular.module('$preloaded', [])"
  != ".constant('$notesUrl', '/bible/#{version.attributes.id}/#{reference.book}.#{reference.chapter}./notes')"
  -#!= ".constant('$chapter', #{reference.to_json})"
  -#!= ".constant('$version', #{version.to_json})"
  -#!= ".constant('$content', '#{reference.content.delete!("\n")}')"
  -#!= ".constant('$next', #{reference.next_chapter_hash.to_json})"
  -#!= ".constant('$previous', #{reference.previous_chapter_hash.to_json})"
  -#!= ".constant('$current', '#{reference.safe_human}')"
  != ";"

= render partial: 'reader', locals: {presenter: @presenter}
