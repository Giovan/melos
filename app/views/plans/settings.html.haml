- @title = "Plan Settings"
- @sidebar = true

- content_for :sidebar do
  .widget
    %header
      %span
        =t("plans.more info")
    %ul.widget_menu
      %li    
        %p
          %b=t("plans.length field")
          = @subscription.length
      - if !current_user.subscribed_to? @subscription      
        %li
          = link_to(t("plans.view sample"), @subscription.slug)
      %li
        = link_to(t("plans.users subscribed", user_count: @subscription.users.count), plan_users_path(@subscription.slug))
  .widget
    %header
      %span
        =t("plans.publisher")
    %ul.widget_menu
      %li
        %p= @subscription.copyright
      %li
        = link_to(t("plans.about publisher"), @subscription.publisher_url)
        -#TODO: view partial for this sidebar plan content

%article
  %dl.combo_button.float_right
    %dt
    %dd
      = link_to t("plans.day"), plan_path(@subscription)
    %dd.settings.highlighted
      = link_to t("plans.settings")
    %dd
      = link_to t("plans.month"), plan_calendar_path(@subscription)
  %h1{style: "clear: none; width: 300px;"}= @subscription.name
  %hr
  %h4= t("plans.settings")
  .progress_wrap{style: "margin-bottom: 10px"}
    .progress_counter
      =t("plans.current progress html", day: @subscription.current_day, total_days: @subscription.total_days).html_safe
    .progress_bar_outer
      .progress_bar{:style => "width:#{@subscription.progress}%"}
        &nbsp;
    .progress_bar_cap
      &nbsp;
    .progress_bar_shadow
      .progress_percent_complete{style: "left:#{@subscription.progress}%"}
        %b= t("percentage display", number: @subscription.progress)
        .small= t("plans.completion status (below percentage)")
  .float_right{style: "margin-bottom: 10px"}
    %div
      %b{style: "margin-right: 10px"}= t("plans.start date (before date string)")
      = @subscription.start.strftime("%B %d, %Y")
    %div
      %b{style: "margin-right: 16px"}= t("plans.end date (before date string)")
      = @subscription.end.strftime("%B %d, %Y")
  
  %hr
  .float_right{style: "margin-top: 0px; margin-right: 0px"}= button_to(t('plans.catch me up'), plan_settings_path(@subscription, catch_up: "true"), :class => 'action_button_green', style: "width: 14em; height: 35px")
  %div{style: "width: 330px"}
    %h5= t("plans.are you behind")
    - if @subscription.last_completed_date
      %p.float_left= t("plans.catch up text", last_completed_day: @subscription.last_completed_day)
    -else 
      %p.float_left= t("plans.catch up description only")
  
  %hr
  .float_right{style: "margin-top: 0px; margin-right: 0px"}= button_to(t('plans.restart'), plan_settings_path(@subscription, restart: "true"), :class => 'action_button_green', style: "width: 14em; height: 35px")
  %div{style: "width: 330px"}
    %h5= t("plans.do you want to reset")
    %p.float_left= t("plans.restart description")  
  
  %hr
  .float_right{style: "margin-top: 0px; margin-right: 0px"}
    -if @subscription.public?
      .float_right= button_to(t('plans.make private'), plan_settings_path(@subscription, make_private: "true"), class: 'action_button_green', style: "width: 14em; height: 35px")
    -else 
      .float_right= button_to(t('plans.make public'), plan_settings_path(@subscription, make_public: "true"), class: 'action_button_green', style: "width: 14em; height: 35px")
  %div{style: "width: 330px"}
    %h5= t("plans.privacy title")
    %p.float_left= t("plans.privacy description")
    
  %hr
  %h5= t("plans.accountability")
  %form{method: 'get'}
    %input{type: "hidden", name: "send_reminder", value: (!@subscription.accountability.send_reminder?).to_s}
    %input{type: "checkbox", onChange: "this.form.submit()", id: "email_me_box",  checked: @subscription.accountability.send_reminder? ? "checked" : nil}
    %label{for: "email_me_box"}= t("plans.email reminder to me", email_address: @subscription.user.email)
  %form{method: 'get'}
    %input{type: "hidden", name: "send_report", value: (@subscription.accountability.report_recipients.empty?).to_s}
    %input{type: "checkbox", onChange: "this.form.submit()", id: "report_box",  checked: @subscription.accountability.report_recipients.empty? ? nil : "checked"}
    %label{for: "report_box"}= t("plans.email weekly report to a friend", email_address: @subscription.user.email)

  %hr
  .float_left{style: "margin-top: 30px; margin-bottom: 30px;"}= button_to(t('plans.stop reading'), plan_settings_path(@subscription, unsubscribe: "true"), class: 'action_button_blue', style: "width: 14em; height: 35px")
  
  