- @title = t("plans.title")
- translate = params[:translate] == "true"
- content_for :title do
  = t("plans.title")

%article#plan-index
  - if current_auth
    %h1.float_left= t("plans.browse plans", category: @categories.current_name || t("plans.all"))
    %dl.combo_button.float_right
      %dt
      %dd.highlighted
        = link_to t("plans.all plans"), plans_path
      %dd
        = link_to t("plans.my plans"), user_subscriptions_path(current_user)
  - else
    %h1= t("plans.browse plans", category: @categories.current_name || t("plans.all"))

  .split_pane
    .sidebar
      .search

        %form#plan-search{method: 'get'}
          - if params[:category]
            %input{type: "hidden", name: "category", value: params[:category]}
          - if params[:translate]
            %input{type: "hidden", name: "translate", value: params[:translate]}
          - if @plan_lang
            %input{type: "hidden", name: "lang", value: @plan_lang}
          %input.field.autofocus{name: "query", type: 'search', placeholder: t("plans.search placeholder", category: @categories.current_name || t("plans.all")), value: params[:query]}
          %input.submit{type: 'submit', value: t("plans.search"), onClick: "$('select.language').attr('disabled','true');"}

        %form{method: 'get'}
          %input{type: "hidden", name: "translate", value: (params[:translate] || "true")}
          - if params[:category]
            %input{type: "hidden", name: "category", value: params[:category]}
          - if params[:query]
            %input{type: "hidden", name: "query", value: params[:query]}

          %select.language{onChange: "this.form.submit();", name: "lang"}
            - (Plan.available_locales & I18n.available_locales).each do |loc|
              %option{value: loc.to_s, selected: loc.to_s == @plan_lang.to_s}
                = t("language name", locale: loc)

      %dl.categories_menu
        %dt
          = t("plans.browse by category")
          - if translate
            - orig_locale = I18n.locale
            - I18n.locale = @plan_lang
        %dd{class: (params[:category] == "" || params[:category].nil?) ? "highlighted" : ""}
          = link_to t("plans.all plans"), plans_path(params.merge(category: nil, locale: orig_locale))
        - level = 0
        - if @categories
          - @categories.breadcrumbs.each do |category|
            - level += 1
            %dd{class: params[:category] == category.slug ? "highlighted" : ""}
              %a{:href => plans_path(params.merge(locale: orig_locale, category: category.slug)), :style => "margin-left:#{level * 20}px"}
                = (params[:category] == category.slug) ? t("plans.all category plans", category: category.name)  : category.name
          - level += 1
          - @categories.items.each do |category|
            %dd{class: params[:category] == category.slug ? "highlighted" : ""}
              %a{:href => plans_path(params.merge(locale: orig_locale, category: category.slug)), :style => "margin-left:#{level * 20}px"}
                = category.name
    .content

      - I18n.locale = orig_locale
      - if I18n.locale.to_s != @plan_lang.to_s
        #filter-message
          = t('plans.showing language filtered', lang_name: t('language name', locale: @plan_lang))
          %span.mute{style: "font-weight: normal; font-size: 12px"}
            = t("plans.swap list localization", swap_locale: t('language name', locale: translate ? I18n.locale : @plan_lang), swap_link: url_for(params.merge(translate: nil, lang: I18n.locale))).html_safe

      - unless @plans.empty?
        %ul.resource_list
          = render partial: "plans/list_item", collection: @plans, locals: {original_locale: orig_locale}
        = render "shared/pagination", resource_list: @plans
      -else
        .none{align: "center"}= t("plans.none found")


