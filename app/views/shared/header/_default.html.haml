:ruby
  is_home_url       = current_page?(moments_path)
  plan_href = logged_in? ? subscriptions_path(user_id: current_auth.username) : plans_path
  live_href = "http://#{([:de, :es, :fr, :ko, :nl, :no, :pt, :ru, :zh_CN, :zh_TW].include?(I18n.locale) ? I18n.locale : :www).to_s.downcase.gsub("_", "-")}.a.youversion.com/live"
  if ['plans', 'subscriptions'].include? controller_name
    searchKey = "plans"
  elsif ['users'].include? controller_name
    searchKey = "users"
  elsif ['search'].include? controller_name
    searchKey = params[:category]
  else
    searchKey = "bible"
  end

.fixed.header-box{"ng-controller" => "HeaderCtrl as ctrl"}
  .ng-hide.nav-more-menu{"ng-show" => "isMoreOpen"}
    %ul.side-nav
      %li
        %a{"href" => videos_path, "target" => "_self"}
          =t("videos.title")
          %img.right{"src" => image_path("icon-reader-arrow.svg")}
      %li
        %a{"href" => live_href, "target" => "_self"}
          =t("live")
          %img.right{"src" => image_path("icon-reader-arrow.svg")}
      - if current_auth
        %li
          %a{"href" => sign_out_path, "target" => "_self"}
            =t("sign out")
            %img.right{"src" => image_path("icon-reader-arrow.svg")}
      - else
        %li
          %a{"href" => sign_in_path(redirect: params[:redirect]), "target" => "_self"}
            =t("sign in")
            %img.right{"src" => image_path("icon-reader-arrow.svg")}
        %li
          %a{"href" => sign_up_path(redirect: params[:redirect]), "target" => "_self"}
            =t("sign up")
            %img.right{"src" => image_path("icon-reader-arrow.svg")}

  .row.full.b-border.t-border.white.collapse.header
    .medium-6.large-5.columns.header-left
      .icon-bar.five-up.hdr-nav
        %a.item.icon-bar-home{href: moments_path, target: "_self"}
          %svg{"enable-background" => "new -291.4 384.3 24.7 24.7", :viewBox => "-291.4 384.3 24.7 24.7", :xmlns => "http://www.w3.org/2000/svg"}
            %path{:class => "line", :d => "M-266.6 396.6l-12.3-12.4-12.4 12.4.7.7 1.6-1.6v13.3h8v-8h4v8h8v-13.3l1.6 1.7.8-.8zm-3.4 11.4h-6v-8h-6v8h-6v-13.3l9-9 9 9v13.3z"}
            %path{:class => "fill", :d => "M-279 384.3l-12.4 12.3.8.8 1.6-1.7v13.3h8v-8h4v8h8v-13.3l1.6 1.7.8-.8z"}
          %label=t("home")
        %a.item.icon-bar-bible{href: bible_localized_path, target: "_self"}
          %svg{"enable-background" => "new -367 283 40 48", :viewBox => "-367 283 40 48", :xmlns => "http://www.w3.org/2000/svg"}
            %path{:class => "line", :d => "M-361 283c-3.3 0-6 2.7-6 6v36c0 3.3 2.7 6 6 6h30v-4h4v-44h-34zm10 46h-10c-2.2 0-4-1.8-4-4v-36h32v40h-18zm22-4h-2v-38h-33.5c.7-1.2 2-2 3.4-2h32v40z"}
            %path{:class => "fill", :d => "M-361 283c-3.3 0-6 2.7-6 6v36c0 3.3 2.7 6 6 6h30v-4h4v-44h-34zm32 42h-2v-38h-33.5c.7-1.2 2-2 3.4-2h32v40z"}
          %label=t("moments.action.read plan")
        %a.item.icon-bar-plans{href: plan_href, target: "_self"}
          %svg{"enable-background" => "new -294 385 22 24", :viewBox => "-294 385 22 24", :xmlns => "http://www.w3.org/2000/svg"}
            %g.line
              %polygon{:points => "-288.1,398.2 -289.5,397.1 -290.2,397.8 -288.6,399.7 -288.1,400.4 -287.5,399.7 -283.8,395.6 -284.4,395"}
              %polygon{:points => "-288.1,404.2 -289.5,403.1 -290.2,403.8 -288.6,405.7 -288.1,406.4 -287.5,405.7 -283.8,401.6 -284.4,400.9"}
              %path{:d => "M-276,385h-1.4H-290c-2.2,0-4,1.8-4,4v20h22v-20C-272,386.8-273.8,385-276,385z M-293,389c0-1.7,1.3-3,3-3h12.6h1.4c1.7,0,3,1.3,3,3v2h-20V389z M-293,408v-16h20v16H-293z"}
              %ellipse{:cx => "-278.8", :cy => "404.3", :rx => "1.4", :ry => "1.4"}
              %polygon{:points => "-279.4,399.7 -275.6,395.6 -276.3,395 -279.9,398.2 -281.3,397.1 -282,397.8 -280.5,399.7 -279.9,400.4"}
            %path.fill{:d => "M-276,385h-1.4H-290c-2.2,0-4,1.8-4,4v2h22v-2C-272,386.8-273.8,385-276,385z"}
            %path.fill{:d => "M-294,392v17h22v-17H-294z M-287.5,405.7l-0.6,0.6l-0.5-0.6l-1.6-1.9l0.7-0.7l1.4,1.1l3.7-3.2l0.6,0.6 L-287.5,405.7z M-287.5,399.7l-0.6,0.6l-0.5-0.6l-1.6-1.9l0.7-0.7l1.4,1.1l3.7-3.2l0.6,0.6L-287.5,399.7z M-278.8,405.7c-0.8,0-1.4-0.6-1.4-1.4c0-0.8,0.6-1.4,1.4-1.4c0.8,0,1.4,0.6,1.4,1.4C-277.4,405-278,405.7-278.8,405.7z M-279.4,399.7l-0.6,0.6l-0.5-0.6l-1.6-1.9l0.7-0.7l1.4,1.1l3.7-3.2l0.6,0.6L-279.4,399.7z"}
          %label=t("searching.plans")
        %a.item.icon-bar-videos{href: videos_path, target: "_self"}
          %svg{"enable-background" => "new 0 0 24 24", :viewBox => "0 0 24 24", :xmlns => "http://www.w3.org/2000/svg"}
            %path{:class =>"line", "clip-rule" => "evenodd", :d => "M9 5v8l8-4.2z", "fill-rule" => "evenodd"}
            %path{:class =>"line", :d => "M21 0h-18c-1.7 0-3 1.3-3 3v12c0 1.7 1.3 3 3 3h8.299999999999999l-5.3 5.3.7.7 4.8-4.8v4.8h1v-4.8l4.8 4.8.7-.7-5.3-5.3h8.299999999999999c1.7 0 3-1.3 3-3v-12c0-1.7-1.3-3-3-3zm2 15c0 1.1-.9 2-2 2h-18c-1.1 0-2-.9-2-2v-12c0-1.1.9-2 2-2h18c1.1 0 2 .9 2 2v12z"}
            %path{:class => "fill", "clip-rule" => "evenodd", :d => "M21 18h-7.6l4.3 4.3c.4.4.4 1 0 1.4-.4.4-1 .4-1.4 0l-3.3-3.3v2.6c0 .5-.4 1-1 1s-1-.5-1-1v-2.6l-3.3 3.3c-.4.4-1 .4-1.4 0-.4-.4-.4-1 0-1.4l4.3-4.3h-7.6c-1.7 0-3-1.3-3-3v-12c0-1.7 1.3-3 3-3h18c1.7 0 3 1.3 3 3v12c0 1.7-1.3 3-3 3zm-12-13v8l8-4.2-8-3.8z", "fill-rule" => "evenodd"}
          %label=t("videos.title")
        %a.item.icon-bar-events{href: live_href, target: "_self"}
          %svg{"enable-background" => "new 0 0 24 23", :viewBox => "0 0 24 23", :xmlns => "http://www.w3.org/2000/svg"}
            %path.line{:d => "M20.2 9.8c-2-2.3-4.9-3.8-8.2-3.8s-6.2 1.5-8.2 3.8l-1.6-1.5c2.4-2.7 5.9-4.4 9.8-4.4s7.4 1.7 9.8 4.4l-1.6 1.5zM17.1 12.9c-1.2-1.5-3-2.5-5.1-2.5-2.1 0-3.9 1-5.1 2.5l-1.5-1.6c1.6-1.9 4-3.1 6.7-3.1s5.1 1.2 6.7 3.1l-1.7 1.6zM8.4 14.5c.8-1.1 2.1-1.8 3.6-1.8s2.8.7 3.6 1.8l-1.6 1.6c-.4-.7-1.1-1.2-2-1.2-.9 0-1.6.5-2 1.2l-1.6-1.6z"}
            %path.line{:d => "M22.6 1c.2 0 .4.2.4.4v17c0 .2-.2.4-.4.4h-7.800000000000001l-.2.2-2.6 2.6-2.6-2.6-.3-.3h-7.7c-.2 0-.4-.2-.4-.4v-17c0-.1.2-.3.4-.3h21.2m0-1h-21.2c-.8 0-1.4.6-1.4 1.4v17c0 .8.6 1.4 1.4 1.4h7.4l3.2 3.2 3.3-3.3h7.4c.8 0 1.4-.6 1.4-1.4v-17c-.1-.7-.7-1.3-1.5-1.3z"}
            %path.fill{:d => "M20.2 9.8c-2-2.3-4.9-3.8-8.2-3.8s-6.2 1.5-8.2 3.8l-1.6-1.5c2.4-2.7 5.9-4.4 9.8-4.4s7.4 1.7 9.8 4.4l-1.6 1.5zm-3.1 3.1c-1.2-1.5-3-2.5-5.1-2.5-2.1 0-3.9 1-5.1 2.5l-1.5-1.6c1.6-1.9 4-3.1 6.7-3.1s5.1 1.2 6.7 3.1l-1.7 1.6zm-8.7 1.6c.8-1.1 2.1-1.8 3.6-1.8s2.8.7 3.6 1.8l-1.6 1.6c-.4-.7-1.1-1.2-2-1.2-.9 0-1.6.5-2 1.2l-1.6-1.6zm15.6-13.1c0-.8-.6-1.4-1.4-1.4h-21.2c-.8 0-1.4.6-1.4 1.4v17c0 .8.6 1.4 1.4 1.4h7.4l3.2 3.2 3.3-3.3h7.4c.8 0 1.4-.6 1.4-1.4v-16.9z"}
          %label=t("live")
        - if current_auth
          %a.item.icon-bar-profile{href: user_path(current_user.username), target: "_self"}
            %svg{"enable-background" => "new -291 385 24 23", :viewBox => "-291 385 24 23", :xmlns => "http://www.w3.org/2000/svg"}
              %path{:class => "line", :d => "M-279 386.1c2.4 0 4.5 1.8 4.9 4.2.1.5.1.9 0 1.4l-.5 3.5c-.3 2.1-2.2 3.8-4.4 3.8h-.6c-1.9-.3-3.5-1.8-3.7-3.7l-.5-3.5c-.2-1.3.1-2.6.9-3.6.8-1.1 1.9-1.7 3.2-1.9.2-.2.5-.2.7-.2m-.3 17c3.4 0 6.8.6 9.1 1.1 1.2.3 2.1 1.4 2.1 2.7v.1h-21.9v-.3c0-1.3.9-2.4 2.2-2.7 2.1-.4 5.2-.9 8.5-.9m.3-18.1c-.3 0-.6 0-.9.1-3.3.5-5.5 3.5-5.1 6.8l.5 3.5c.3 2.3 2.2 4.3 4.6 4.6l.8.1c2.7 0 5-2 5.4-4.7l.5-3.5c.1-.5.1-1.1 0-1.7-.3-3.1-2.9-5.2-5.8-5.2zm-.3 17c-3.3 0-6.5.5-8.7.9-1.8.4-3 1.9-3 3.7v1.3h24v-1.1c0-1.8-1.2-3.3-2.9-3.7-2.4-.5-5.9-1.1-9.4-1.1z"}
              %path{:class => "fill", :d => "M-273.6 395.3c-.4 3-3.2 5-6.2 4.6-2.5-.4-4.3-2.3-4.6-4.6l-.5-3.5c-.5-3.3 1.8-6.3 5.1-6.8s6.3 1.8 6.8 5c.1.6.1 1.2 0 1.7l-.6 3.6zm-17.4 12.7v-1.3c0-1.8 1.3-3.4 3-3.7 2.2-.4 5.4-.9 8.7-.9 3.5 0 7 .6 9.3 1.2 1.7.4 2.9 1.9 2.9 3.7v1.1h-23.9v-.1z"}
            %label=t("myself")
        %a.item.icon-bar-more{"ng-click" => "isMoreOpen = !isMoreOpen"}
          %svg{"enable-background" => "new -383.5 295.5 25 22", :viewBox => "-383.5 295.5 25 22", :xmlns => "http://www.w3.org/2000/svg"}
            %path{:class => "line", :d => "M-380.5 317.5c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm0-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm22 4h-16v-4h16v4zm-15-1h14v-2h-14v2zm-7-6c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm0-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm22 4h-16v-4h16v4zm-15-1h14v-2h-14v2zm-7-6c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm0-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm22 4h-16v-4h16v4zm-15-1h14v-2h-14v2z"}
            %g{:class => "fill"}
              %path{:d => "M-359 316h-15v-3h15v3zm0-8h-15v-3h15v3zm0-8h-15v-3h15v3zm-21.5 17c1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5-2.5 1.1-2.5 2.5 1.1 2.5 2.5 2.5zm0-8c1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5-2.5 1.1-2.5 2.5 1.1 2.5 2.5 2.5zm0-8c1.4 0 2.5-1.1 2.5-2.5s-1.1-2.5-2.5-2.5-2.5 1.1-2.5 2.5 1.1 2.5 2.5 2.5z"}
              %path{:d => "M-380.5 317.5c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm0-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm22 4h-16v-4h16v4zm-15-1h14v-2h-14v2zm-7-6c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm0-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm22 4h-16v-4h16v4zm-15-1h14v-2h-14v2zm-7-6c-1.7 0-3-1.3-3-3s1.3-3 3-3 3 1.3 3 3-1.3 3-3 3zm0-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm22 4h-16v-4h16v4zm-15-1h14v-2h-14v2z"}
          %label=t("more")

    .medium-6.large-7.columns.pad-head.show-for-medium-up.header-right
      %form{action: search_path(category: searchKey), method: "GET"}

        - if current_auth
          .hdr-notify
            %md-menu{"md-offset" => "-4 44", "md-position-mode" => "target-right target"}
              %a{"ng-click" => "ctrl.openMenu($mdOpenMenu, $event, 'notify-menu')"}
              %md-menu-content.ng-hide{:width => "4", "ng-show" => "true", "class" => "padded"}
                %div{"header-friendships" => true}
                %div{"header-notifications" => true}
          .hdr-profile
            %md-menu{"md-offset" => "-4 44", "md-position-mode" => "target-right target"}
              %a{ title: t("users.go to your profile"), "ng-click" => "ctrl.openMenu($mdOpenMenu, $event, 'profile-menu')"}
                %img.hdr-profile-img{src: current_user.user_avatar_url["px_48x48"]}
                - if current_user.first_name.present? and current_user.last_name.present?
                  %span.hdr-profile-name.large= current_user.first_name + " " + current_user.last_name
                  %span.hdr-profile-name.medium= current_user.username
                -else
                  %span.hdr-profile-name= current_user.username
              %md-menu-content.ng-hide{:width => "4", "ng-show" => "true"}
                %md-menu-item
                  %md-button{href: highlights_user_path(current_auth.username), target: "_self"}
                    =t("highlights.title")
                %md-menu-item
                  %md-button{href: bookmarks_user_path(current_auth.username), target: "_self"}
                    =t("bookmarks.title")
                %md-menu-item
                  %md-button{href: notes_user_path(current_auth.username), target: "_self"}
                    =t("notes title")
                %md-menu-item
                  %md-button{href: images_user_path(current_auth.username), target: "_self"}
                    =t("users.my images")
                %md-menu-item
                  %md-button{href: user_friends_path(user_id: current_auth.username), target: "_self"}
                    =t("users.profile.tab friends")
                %md-menu-item
                  %md-button{href: badges_user_path(current_auth.username), target: "_self"}
                    =t("badges title")
                %md-menu-divider
                %md-menu-item
                  %md-button{href: "/settings", target: "_self"}
                    =t("settings")
                %md-menu-item
                  %md-button{href: sign_out_path, target: "_self"}
                    =t("sign out")

        - else
          .sign-inup
            = link_to t("sign in"), sign_in_path(redirect: params[:redirect]), class: "sign-in", target: "_self"
            = link_to t("sign up"), sign_up_path(redirect: params[:redirect]), class: "sign-up", target: "_self"

        .hdr-search
          %input{type: 'search', name:"q", placeholder: t("search placeholder")}
          %input.search.postfix.button{type: 'submit', value: ''}
          -if params[:version_id]
            %input{type: 'hidden', name: "version_id", value: params[:version_id], extra:'first'}
          -elsif params[:version]
            %input{type:'hidden', name:"version_id", value:params[:version], extra:'second'}

= render partial: 'shared/header/js_templates'

-#
  /     .header-user
  /       -# Sign in and user id
  /       - if current_auth
  /         %nav.sign_in
  /           %a{href: user_path(current_auth.username), title: t("users.go to your profile")}
  /             %span
  /               %img{src: current_user.user_avatar_url["px_24x24"]}
  /               %span.user_name=current_auth.username

  /         %ul.nav_user
  /           %li.highlights
  /             %a{href: highlights_user_path(current_auth.username), title: t("highlights.title") }
  /           %li.bookmarks
  /             %a{href: bookmarks_user_path(current_auth.username), title: t("bookmarks.title")}
  /           %li.notes
  /             %a{href: notes_user_path(current_auth.username), title: t("notes title")}
  /           %li.auth
  /             %a#header_profile_trigger{:href => '#'}
  /               =t("more")

  /             #header_profile_menu
  /               %span.arrow
  /               %ol
  /                 %li.header_profile_menu_activity
  /                   %a{href: user_path(current_auth.username)}
  /                     =t("users.profile.tab activity")
  /                 %li.header_profile_menu_friends
  /                   %a{href: user_friends_path(user_id: current_auth.username)}
  /                     =t("users.profile.tab friends")
  /                 - #%li
  /                 - #  %a{href: badges_user_path(current_auth.username)}
  /                 - #    =t("users.profile.tab badges")
  /                 %li.header_profile_menu_settings
  /                   %a{href: "/settings"}
  /                     =t("settings")
  /                 %li.header_profile_menu_signout
  /                   %a{href: sign_out_path}
  /                     =t("sign out")

  /         .user_options
  /           %a.friend-requests-btn.popover-link{href: "#", class: is_home_url ? 'home-url' : '', title: t("friendships.requests title") }
  /             =t("friendships.requests title")
  /             %span.friend-request-count.badge
  /           - if current_user.enable_friendships?
  /             = render partial: "shared/header/friends"
  /           - else
  /             = render partial: "shared/header/update_profile"

  /           %a.notifications-btn.popover-link{href: "#", class: is_home_url ? 'home-url' : '', title: t("notifications.title") }
  /             =t("notifications.title")
  /             %span.notifications-count.badge
  /           = render partial: "shared/header/notifications"

  /       - else
  /         %nav.no_auth
  /           %ul
  /             %li
  /               = link_to t("sign in"), sign_in_path(redirect: params[:redirect]), class: "sign_in"
  /             %li
  /               = link_to t("sign up"), sign_up_path(redirect: params[:redirect]), class: "sign_in"


  /     .mobile
  /       - if content_for? :mobile_left_nav
  /         = yield :mobile_left_nav
  /       - else
  /         %a#slideToNav.nav_btn{href: 'javascript:void(0);'}
  /           View Navigation
  /       - if content_for? :title
  /         %h1#page_title= yield :title
  /       - if content_for? :title_link
  /         %h1#chapter_title= yield :title_link
  /       - if content_for? :mobile_right_nav
  /         %nav.right_nav
  /           - if content_for? :mobile_subscription_nav
  /             = yield :mobile_subscription_nav
  /           - else
  /             = yield :mobile_right_nav


