:ruby
  @title = "#{t('plans.day number', day: @presenter.day)} - #{@presenter.subscription_name}"
  content_for(:body_class, "reading_plan")
  subscription  = presenter.subscription
  day           = presenter.day
  reading       = presenter.reading
  content_page  = presenter.content_page
  statuses      = subscription.day_statuses
  references    = reading.references(version_id: subscription.version_id)
  case references.size
  when 1
    readings_text = "1 " + t("plans.widget.reading")
  when 2..4
    readings_text = references.size.to_s + " " + t("plans.widget.readings")
  else
    readings_text = references.size.to_s + " " + t("plans.widget.readings 5 or more")
  end

.subscription-show
  .row
    .columns.large-8.medium-8.medium-centered.text-center
      .left
        = link_to subscriptions_path(user_id: current_user.to_param), target: "_self" do
          - if is_rtl?
            != "&rarr; #{t('searching.plans')}"
          - else
            != "&larr; #{t('searching.plans')}"

      .right
        %a!= "&bull;&bull;&bull;"

      - if subscription.list_image.present?
        = image_tag subscription.list_image.url
      %h3= subscription.name

  .row
    .columns.large-8.medium-8.medium-centered
      .day-slider
        - statuses.each do |cur_status|
          - cur_date = Date.parse(cur_status.date)
          - is_active = cur_status.day.equal? @presenter.day
          = link_to(subscription_path(user_id: current_user.to_param, id: subscription, day: cur_status.day), "target" => "_self" ) do
            .day{class:"#{cur_status.completed ? 'completed' : ''} #{is_active ? 'active' : ''}"}
              %h1.text-center= cur_status.day
              %h4.text-center= I18n.l(cur_date, format: :short)

  .row
    .columns.large-8.medium-8.medium-centered
      .right
        = link_to devo_subscription_path(user_id: current_user.to_param, id: subscription, day: @presenter.day), target: "_self", class: 'solid-button green' do
          = t("plans.widget.start reading")

      %p!= "#{t("plans.current progress html", day: @presenter.day, total_days: subscription.total_days).html_safe} &bull; On Track"

      %ul
        -if presenter.reading.devotional
          %li
            = link_to devo_subscription_path(user_id: current_user.to_param, id: subscription, day: @presenter.day), target: "_self" do
              -if statuses[day - 1].additional_content.completed
                ="X"
              -else
                ="O"
                = t("plans.devotional")

          - unless references.empty?
            - references.each_with_index do |ref,index|
              %li{class: "#{ref.completed ? 'completed' : ''}"}
                -if ref.completed
                  = "X" #replace with image
                -else
                  = "O" #replace with image

                -# form_tag(subscription_path(user_id: current_user.to_param, id: subscription), method: :put) do
                  - # todo: sometimes day isn't passed with params. need to investigate
                  = hidden_field_tag(:ref,            ref.reference.to_param)
                  = hidden_field_tag(:completed,      (!ref.completed))
                  = hidden_field_tag(:version,        subscription.version_id)
                  = hidden_field_tag(:day_target,     day.to_s)
                  = hidden_field_tag(:content_target, index )     if index != 0
                  = check_box_tag(:completion, nil, ref.completed, {id:"#{index}_box",onChange: "this.form.submit()"} )

                -# if content_page == index
                  %span
                    -#%b.mobile= t("plans.read today").capitalize
                    = ref.reference.safe_human
                  - else
                -# hrref: (content_page == index) ? nil : subscription_path(user_id: current_user.to_param, id: subscription , day: day.to_s, content: (index > 0 ? index.to_s : nil), version: params[:version])
                -#{"ng-click" => "completeReferenceAndLoadChapter('reader', {version: #{ref.reference.version.to_s}, usfm: '#{ref.reference.chapter_usfm.downcase}'}, '#{ref.reference.to_param.downcase}', '#{subscription_path(user_id: current_user.to_param, id: subscription)}', '#{day.to_s}', '#{form_authenticity_token}')", "ng-class" => "{active: isRefActive('#{ref.reference.to_param.downcase}') && !devotionalActive, completed: isRefComplete('#{ref.reference.to_param.downcase}') || '#{ref.completed}' == 'true' }"}

                %a
                  -#%a{"ng-click" => "loadChapter('reader', {version: #{ref.reference.version.to_s}, usfm: '#{ref.reference.chapter_usfm.downcase}'})", "ng-class" => "{active:usfm == '#{ref.reference.chapter_usfm.downcase}'}"}
                  = ref.reference.safe_human