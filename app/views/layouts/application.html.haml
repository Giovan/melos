!!! 5

:ruby
  # TODO: Refactor these 'floating' @instance variables into something more concise/explicit
  container_classes = []
  container_classes << "no_sidebar" if @sidebar == false
  container_classes << "no_primary_nav" if @main_nav == false
  container_class_str = container_classes.join(" ")

%html{class: (@html_classes.join(' ') if @html_classes), "data-locale" => I18n.locale, id: @html_id}

  %head{lang: 'en-us'}
    = csrf_meta_tags
    = render '/shared/head'
    = render '/shared/javascripts'
    = render '/shared/google_analytics'

  %body
    #wrapper{class: @fixed_width == true ? 'fixed_width' : ''}

      = content_for?(:header) ? yield(:header) : render("/shared/header/default")

      - flash.each do |key, msg|
        %div{class: container_class_str, id: "flash_#{key}"}= msg

      #container{class: container_class_str}
        #main{role: "main", class: @is_reader == true ? 'main_reader' : ''}
          = render partial: '/shared/nav_primary' unless @main_nav == false
          = content_for?(:main) ? yield(:main) : yield
          - if content_for? :main_trailer
            = yield :main_trailer
        #sidebar
          - if content_for? :sidebar
            = yield :sidebar
          - else
            - unless (@sidebar == false || sidebar_presenter.blank?)
              = render partial: sidebar_presenter.sidebar_partial, locals: {presenter: sidebar_presenter}

      = render partial: '/shared/nav_mobile' unless @main_nav == false
      = render partial: '/shared/footer', locals: {footer_classes: container_class_str}
