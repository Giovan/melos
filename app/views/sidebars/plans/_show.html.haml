// Local parameters
// presenter: Presenter::Sidebar::Plan
- plan = presenter.plan

-#
  :javascript
    $(document).ready(function() {
      $('.rp-view-all a').click(function() {
        $(this).parent().prev().toggleClass('open', 250);
        $(this).parent().children('a').toggleClass('hidden');
      });
    });

.widget
  .row.b-border
    .columns.small-12
      %h3.hd
        =t("plans.publisher")
  .row.b-border.pad-row
    .columns.small-12
      %div.bd
        %p= plan.copyright.html_safe
  - unless plan.publisher_url.nil?
    .row.pad-row
      .columns.small-12
        %div.ft.link
          = link_to(t("plans.about publisher"), plan.publisher_url)

  - if @friends_reading.present? and @friends_reading.length > 0
    .row.b-border.pad-row
      .columns.small-12
        %h3.hd
          =t("plans.stats.friends reading", count: @friends_reading.length)

    .row.pad-row
      .columns.small-12.rp-widget-avatars
        - @friends_reading.each do |friend|
          - if friend["avatar"].present?
            %a{href: user_path(friend["username"]), title: friend["name"], target: "_self"}
              = image_tag friend["avatar"]["renditions"].select {|a| a["width"] >= 128 }.max{|a| a[:width] }["url"], { class: "avatar" }

        - if @friends_reading.length > 6
          .rp-view-all
            %hr
            %a.open{href: "#"}
              =t("plans.stats.view all")
            %a.close.hidden{href: "#"}
              =t("plans.stats.close")


- if @friends_completed.present? and @friends_completed.length > 0
  .row.b-border.pad-row
    .columns.small-12
      %h3.hd
        =t("plans.stats.friends completed", count: @friends_completed.length)
  .row.pad-row
    .columns.small-12.rp-widget-avatars
      - @friends_completed.each do |friend|
        - if friend["avatar"].present?
          %a{href: user_path(friend["username"]), title: friend["name"], target: "_self"}
            = image_tag friend["avatar"]["renditions"].select {|a| a["width"] >= 128 }.max{|a| a[:width] }["url"], { class: "avatar" }
      - if @friends_completed.length > 6
        .rp-view-all
          %hr
          %a.open{href: "#"}
            =t("plans.stats.view all")
          %a.close.hidden{href: "#"}
            =t("plans.stats.close")


- if plan.total_completions >= 1000
  .row.b-border.pad-row
    .columns.small-12
      =t("plans.stats.total completions", count: plan.total_completions)