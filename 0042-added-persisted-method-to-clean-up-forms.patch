From 7122fe16646c51b8e62d84fbcf3970d1f04d4027 Mon Sep 17 00:00:00 2001
From: Chad Bailey <chadbailey@gmail.com>
Date: Mon, 31 Oct 2011 12:25:18 -0500
Subject: [PATCH 42/55] added persisted method to clean up forms

Change-Id: Iddfbc15cec374aeea6394d098031e0f4b63d7f7f
---
 Gemfile                                 |   10 +-
 Gemfile.lock                            |  210 +++++++++++++++----------------
 app/controllers/notes_controller.rb     |    8 --
 app/models/note.rb                      |    4 +-
 app/views/layouts/application.html.haml |    1 -
 app/views/notes/_form.html.haml         |    2 +-
 6 files changed, 109 insertions(+), 126 deletions(-)
 create mode 100644 public/stylesheets/notes.css.css
 create mode 100644 public/stylesheets/reference.css.css
 create mode 100644 public/stylesheets/sessions.css.css
 create mode 100644 public/stylesheets/users.css.css
 create mode 100644 public/stylesheets/version.css.css
 create mode 100644 public/stylesheets/versions.css.css

diff --git a/Gemfile b/Gemfile
index 46bbae8..e812cbf 100644
--- a/Gemfile
+++ b/Gemfile
@@ -7,11 +7,8 @@ gem 'hashie'
 gem 'cells'
 gem 'haml-rails', "  ~> 0.3.4"
 gem 'jquery-rails'
-gem 'coffee-script'
-
-# Bundle edge Rails instead:
-# gem 'rails',     :git => 'git://github.com/rails/rails.git'
-
+gem 'pg'
+gem 'routing-filter'
 
 
 # Gems used only for assets and not required
@@ -19,6 +16,8 @@ gem 'coffee-script'
 group :assets do
   gem 'sass-rails', "  ~> 3.1.0"
   gem 'uglifier'
+  gem 'compass', '~> 0.11.1'
+  gem 'css_parser', '~> 1.1.9'
 end
 
 
@@ -55,5 +54,4 @@ end
 
 group :development do
   gem 'pry'
-  gem 'ruby-debug19', :require => 'ruby-debug'
 end
diff --git a/Gemfile.lock b/Gemfile.lock
index d08ea84..0fc9539 100644
--- a/Gemfile.lock
+++ b/Gemfile.lock
@@ -1,38 +1,39 @@
 GEM
   remote: http://rubygems.org/
   specs:
-    actionmailer (3.1.1)
-      actionpack (= 3.1.1)
+    actionmailer (3.1.0)
+      actionpack (= 3.1.0)
       mail (~> 2.3.0)
-    actionpack (3.1.1)
-      activemodel (= 3.1.1)
-      activesupport (= 3.1.1)
+    actionpack (3.1.0)
+      activemodel (= 3.1.0)
+      activesupport (= 3.1.0)
       builder (~> 3.0.0)
       erubis (~> 2.7.0)
       i18n (~> 0.6)
       rack (~> 1.3.2)
-      rack-cache (~> 1.1)
+      rack-cache (~> 1.0.3)
       rack-mount (~> 0.8.2)
       rack-test (~> 0.6.1)
-      sprockets (~> 2.0.2)
-    activemodel (3.1.1)
-      activesupport (= 3.1.1)
+      sprockets (~> 2.0.0)
+    activemodel (3.1.0)
+      activesupport (= 3.1.0)
+      bcrypt-ruby (~> 3.0.0)
       builder (~> 3.0.0)
       i18n (~> 0.6)
-    activerecord (3.1.1)
-      activemodel (= 3.1.1)
-      activesupport (= 3.1.1)
+    activerecord (3.1.0)
+      activemodel (= 3.1.0)
+      activesupport (= 3.1.0)
       arel (~> 2.2.1)
       tzinfo (~> 0.3.29)
-    activeresource (3.1.1)
-      activemodel (= 3.1.1)
-      activesupport (= 3.1.1)
-    activesupport (3.1.1)
+    activeresource (3.1.0)
+      activemodel (= 3.1.0)
+      activesupport (= 3.1.0)
+    activesupport (3.1.0)
       multi_json (~> 1.0)
     addressable (2.2.6)
     ansi (1.3.0)
-    archive-tar-minitar (0.5.2)
     arel (2.2.1)
+    bcrypt-ruby (3.0.0)
     builder (3.0.0)
     capybara (1.0.1)
       mime-types (>= 1.16)
@@ -41,24 +42,25 @@ GEM
       rack-test (>= 0.5.4)
       selenium-webdriver (~> 2.0)
       xpath (~> 0.1.4)
-    cells (3.7.0)
+    cells (3.6.5)
       actionpack (~> 3.0)
       railties (~> 3.0)
     childprocess (0.2.2)
       ffi (~> 1.0.6)
+    chunky_png (1.2.5)
     coderay (0.9.8)
-    coffee-script (2.2.0)
-      coffee-script-source
-      execjs
-    coffee-script-source (1.1.2)
-    columnize (0.3.4)
-    crack (0.3.1)
-    cucumber (1.1.0)
+    compass (0.11.5)
+      chunky_png (~> 1.2)
+      fssm (>= 0.2.7)
+      sass (~> 3.1)
+    crack (0.1.8)
+    css_parser (1.1.9)
+    cucumber (1.0.2)
       builder (>= 2.1.2)
       diff-lcs (>= 1.1.2)
-      gherkin (~> 2.5.0)
+      gherkin (~> 2.4.5)
       json (>= 1.4.6)
-      term-ansicolor (>= 1.0.6)
+      term-ansicolor (>= 1.0.5)
     cucumber-rails (0.5.2)
       capybara (>= 1.0.0.rc1)
       cucumber (>= 0.10.5)
@@ -66,29 +68,30 @@ GEM
       rack-test (>= 0.5.7)
     diff-lcs (1.1.3)
     erubis (2.7.0)
-    execjs (1.2.9)
+    execjs (1.2.4)
       multi_json (~> 1.0)
     ffi (1.0.9)
-    gherkin (2.5.4)
+    fssm (0.2.7)
+    gherkin (2.4.16)
       json (>= 1.4.6)
-    guard (0.8.8)
+    guard (0.6.3)
       thor (~> 0.14.6)
     guard-bundler (0.1.3)
       bundler (>= 1.0.0)
       guard (>= 0.2.2)
-    guard-cucumber (0.7.3)
+    guard-cucumber (0.6.2)
       cucumber (>= 0.10)
-      guard (>= 0.8.3)
-    guard-rspec (0.5.0)
-      guard (>= 0.8.4)
-    haml (3.1.3)
+      guard (>= 0.4.0)
+    guard-rspec (0.4.4)
+      guard (>= 0.4.0)
+    haml (3.1.2)
     haml-rails (0.3.4)
       actionpack (~> 3.0)
       activesupport (~> 3.0)
       haml (~> 3.0)
       railties (~> 3.0)
-    hashie (1.2.0)
-    heroku (2.11.0)
+    hashie (1.1.0)
+    heroku (2.7.0)
       launchy (>= 0.3.2)
       rest-client (~> 1.6.1)
       rubyzip
@@ -97,38 +100,36 @@ GEM
       heroku (>= 2)
       rails (>= 2)
     hike (1.2.1)
-    httparty (0.8.1)
-      multi_json
-      multi_xml
+    httparty (0.7.8)
+      crack (= 0.1.8)
     i18n (0.6.0)
-    jquery-rails (1.0.16)
+    jquery-rails (1.0.13)
       railties (~> 3.0)
       thor (~> 0.14)
-    json (1.6.1)
-    json_pure (1.6.1)
+    json (1.5.4)
+    json_pure (1.5.4)
+      spruz (~> 0.2.8)
     launchy (2.0.5)
       addressable (~> 2.2.6)
-    linecache19 (0.5.12)
-      ruby_core_source (>= 0.1.4)
     mail (2.3.0)
       i18n (>= 0.4.0)
       mime-types (~> 1.16)
       treetop (~> 1.4.8)
     memcache-client (1.8.5)
-    method_source (0.6.6)
-      ruby_parser (~> 2.0.5)
-    mime-types (1.17.1)
+    method_source (0.6.5)
+      ruby_parser (>= 2.0.5)
+    mime-types (1.16)
     multi_json (1.0.3)
-    multi_xml (0.4.1)
     nokogiri (1.5.0)
+    pg (0.11.0)
     polyglot (0.3.2)
-    pry (0.9.6.2)
-      coderay (~> 0.9.8)
-      method_source (~> 0.6.5)
-      ruby_parser (~> 2.0.5)
-      slop (~> 2.1.0)
-    rack (1.3.5)
-    rack-cache (1.1)
+    pry (0.9.3)
+      coderay (>= 0.9.8)
+      method_source (>= 0.6.0)
+      ruby_parser (>= 2.0.5)
+      slop (~> 1.9.0)
+    rack (1.3.2)
+    rack-cache (1.0.3)
       rack (>= 0.4)
     rack-mount (0.8.3)
       rack (>= 1.0.0)
@@ -136,88 +137,79 @@ GEM
       rack
     rack-test (0.6.1)
       rack (>= 1.0)
-    rails (3.1.1)
-      actionmailer (= 3.1.1)
-      actionpack (= 3.1.1)
-      activerecord (= 3.1.1)
-      activeresource (= 3.1.1)
-      activesupport (= 3.1.1)
+    rails (3.1.0)
+      actionmailer (= 3.1.0)
+      actionpack (= 3.1.0)
+      activerecord (= 3.1.0)
+      activeresource (= 3.1.0)
+      activesupport (= 3.1.0)
       bundler (~> 1.0)
-      railties (= 3.1.1)
-    railties (3.1.1)
-      actionpack (= 3.1.1)
-      activesupport (= 3.1.1)
+      railties (= 3.1.0)
+    railties (3.1.0)
+      actionpack (= 3.1.0)
+      activesupport (= 3.1.0)
       rack-ssl (~> 1.3.2)
       rake (>= 0.8.7)
       rdoc (~> 3.4)
       thor (~> 0.14.6)
-    rake (0.9.2.2)
-    rdoc (3.11)
-      json (~> 1.4)
+    rake (0.9.2)
+    rdoc (3.9.4)
     rest-client (1.6.7)
       mime-types (>= 1.16)
-    rspec (2.7.0)
-      rspec-core (~> 2.7.0)
-      rspec-expectations (~> 2.7.0)
-      rspec-mocks (~> 2.7.0)
-    rspec-cells (0.1.0)
+    routing-filter (0.2.4)
+      actionpack
+    rspec (2.6.0)
+      rspec-core (~> 2.6.0)
+      rspec-expectations (~> 2.6.0)
+      rspec-mocks (~> 2.6.0)
+    rspec-cells (0.0.5)
+      cells (~> 3.4)
       rails (~> 3.0)
       rspec-rails (~> 2.2)
-    rspec-core (2.7.1)
-    rspec-expectations (2.7.0)
+    rspec-core (2.6.4)
+    rspec-expectations (2.6.0)
       diff-lcs (~> 1.1.2)
-    rspec-mocks (2.7.0)
-    rspec-rails (2.7.0)
+    rspec-mocks (2.6.0)
+    rspec-rails (2.6.1)
       actionpack (~> 3.0)
       activesupport (~> 3.0)
       railties (~> 3.0)
-      rspec (~> 2.7.0)
-    ruby-debug-base19 (0.11.25)
-      columnize (>= 0.3.1)
-      linecache19 (>= 0.5.11)
-      ruby_core_source (>= 0.1.4)
-    ruby-debug19 (0.11.6)
-      columnize (>= 0.3.1)
-      linecache19 (>= 0.5.11)
-      ruby-debug-base19 (>= 0.11.19)
-    ruby_core_source (0.1.5)
-      archive-tar-minitar (>= 0.5.2)
-    ruby_parser (2.0.6)
+      rspec (~> 2.6.0)
+    ruby_parser (2.2.0)
       sexp_processor (~> 3.0)
     rubyzip (0.9.4)
-    sass (3.1.10)
-    sass-rails (3.1.4)
+    sass (3.1.7)
+    sass-rails (3.1.0)
       actionpack (~> 3.1.0)
       railties (~> 3.1.0)
       sass (>= 3.1.4)
-      sprockets (~> 2.0.0)
-      tilt (~> 1.3.2)
-    selenium-webdriver (2.9.1)
+    selenium-webdriver (2.5.0)
       childprocess (>= 0.2.1)
-      ffi (= 1.0.9)
+      ffi (>= 1.0.7)
       json_pure
       rubyzip
-    sexp_processor (3.0.7)
-    slop (2.1.0)
-    sprockets (2.0.3)
+    sexp_processor (3.0.6)
+    slop (1.9.1)
+    sprockets (2.0.0)
       hike (~> 1.2)
       rack (~> 1.0)
       tilt (!= 1.3.0, ~> 1.1)
-    term-ansicolor (1.0.7)
+    spruz (0.2.13)
+    term-ansicolor (1.0.6)
     thor (0.14.6)
     tilt (1.3.3)
     treetop (1.4.10)
       polyglot
       polyglot (>= 0.3.1)
-    turn (0.8.3)
-      ansi
-    tzinfo (0.3.30)
-    uglifier (1.0.4)
+    turn (0.8.2)
+      ansi (>= 1.2.2)
+    tzinfo (0.3.29)
+    uglifier (1.0.2)
       execjs (>= 0.3.0)
       multi_json (>= 1.0.2)
     vcr (1.11.3)
-    webmock (1.7.7)
-      addressable (> 2.2.5, ~> 2.2)
+    webmock (1.7.6)
+      addressable (~> 2.2, > 2.2.5)
       crack (>= 0.1.7)
     xpath (0.1.4)
       nokogiri (~> 1.3)
@@ -228,7 +220,8 @@ PLATFORMS
 DEPENDENCIES
   capybara (~> 1.0.0.beta1)
   cells
-  coffee-script
+  compass (~> 0.11.1)
+  css_parser (~> 1.1.9)
   cucumber-rails (~> 0.5.0.beta1)
   guard
   guard-bundler
@@ -240,11 +233,12 @@ DEPENDENCIES
   httparty
   jquery-rails
   memcache-client
+  pg
   pry
   rails (~> 3.1.0)
+  routing-filter
   rspec-cells
   rspec-rails (>= 2.6.0)
-  ruby-debug19
   sass-rails (~> 3.1.0)
   turn
   uglifier
diff --git a/app/controllers/notes_controller.rb b/app/controllers/notes_controller.rb
index b6cf1ea..638cf5a 100644
--- a/app/controllers/notes_controller.rb
+++ b/app/controllers/notes_controller.rb
@@ -16,8 +16,6 @@ class NotesController < ApplicationController
   def new
     if current_auth
       @note = Note.new()
-      @url_path = notes_path
-      @url_method = :post
     else
       redirect_to notes_path
     end
@@ -27,8 +25,6 @@ class NotesController < ApplicationController
     if current_auth
       @note = Note.find(params[:id], current_auth)
       @note.reference = @note.reference.osis_noversion
-      @url_path = notes_path << '/' << params[:id]
-      @url_method = :put
     else
       redirect_to notes_path
     end    
@@ -41,8 +37,6 @@ class NotesController < ApplicationController
     if @note.create
       render action: "show"
     else
-      @url_path = notes_path
-      @url_method = :post
       render action: "new"
     end    
   end
@@ -53,8 +47,6 @@ class NotesController < ApplicationController
     if @note.update(params[:id], params[:note])
       render action: "show"
     else
-      @url_path = notes_path << '/' << params[:id]
-      @url_method = :put
       render action: "edit"
     end    
   end
diff --git a/app/models/note.rb b/app/models/note.rb
index 2989cf3..88c1cdb 100644
--- a/app/models/note.rb
+++ b/app/models/note.rb
@@ -3,13 +3,13 @@ class Note
   include ActiveModel::Conversion
   include Model
   def persisted?
-    false
+    return !id.blank?
   end
 
   attr_reader :errors
   
   def initialize(params = {})
-    reg_data = {id: 0, title: "", content: "", prexml_content: "", language_iso: "", reference: "", version: "", published: "", user_status: "", share_connections: "", auth: nil}    
+    reg_data = {id: nil, title: "", content: "", prexml_content: "", language_iso: "", reference: "", version: "", published: "", user_status: "", share_connections: "", auth: nil}    
     initialize_class(self, params, reg_data)    
   end
   
diff --git a/app/views/layouts/application.html.haml b/app/views/layouts/application.html.haml
index 7f771d4..3614ea8 100644
--- a/app/views/layouts/application.html.haml
+++ b/app/views/layouts/application.html.haml
@@ -3,7 +3,6 @@
   %head
     %title YouversionWeb
     = stylesheet_link_tag    "application"
-    = javascript_include_tag "application"
     = csrf_meta_tags
   %body
     - flash.each do |key, msg|
diff --git a/app/views/notes/_form.html.haml b/app/views/notes/_form.html.haml
index 14e6797..b738771 100644
--- a/app/views/notes/_form.html.haml
+++ b/app/views/notes/_form.html.haml
@@ -1,4 +1,4 @@
-= form_for @note, :url => @url_path, :method => @url_method do |f|
+= form_for @note do |f|
   - if @note.errors
     .form_errors
       The following error(s) prevented creation of your note:
diff --git a/public/stylesheets/notes.css.css b/public/stylesheets/notes.css.css
new file mode 100644
index 0000000..e69de29
diff --git a/public/stylesheets/reference.css.css b/public/stylesheets/reference.css.css
new file mode 100644
index 0000000..e69de29
diff --git a/public/stylesheets/sessions.css.css b/public/stylesheets/sessions.css.css
new file mode 100644
index 0000000..e69de29
diff --git a/public/stylesheets/users.css.css b/public/stylesheets/users.css.css
new file mode 100644
index 0000000..e69de29
diff --git a/public/stylesheets/version.css.css b/public/stylesheets/version.css.css
new file mode 100644
index 0000000..e69de29
diff --git a/public/stylesheets/versions.css.css b/public/stylesheets/versions.css.css
new file mode 100644
index 0000000..e69de29
-- 
1.7.0.4

