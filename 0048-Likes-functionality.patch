From 9f77c0dceda91b64762180090da68455fff4c363 Mon Sep 17 00:00:00 2001
From: Caedmon Judd <caedmon@statebuilt.com>
Date: Sun, 6 Nov 2011 22:48:15 -0600
Subject: [PATCH 48/55] Likes functionality

---
 app/controllers/notes_controller.rb |    6 +++++-
 app/models/like.rb                  |   22 +++++++++-------------
 app/models/user.rb                  |    6 +++++-
 config/routes.rb                    |    1 +
 4 files changed, 20 insertions(+), 15 deletions(-)

diff --git a/app/controllers/notes_controller.rb b/app/controllers/notes_controller.rb
index 4960cae..1496ceb 100644
--- a/app/controllers/notes_controller.rb
+++ b/app/controllers/notes_controller.rb
@@ -63,8 +63,12 @@ class NotesController < ApplicationController
   end
 
   def like
-    if Like.like(params[:id])
+    @like = Like.find(params[:id], current_auth)
+
+    if @like.update(params[:id], params[:like_value], current_auth)
       render action: "show"
+    else
+      #TODO: Complete
     end
   end
 
diff --git a/app/models/like.rb b/app/models/like.rb
index abf56b7..8f921f3 100644
--- a/app/models/like.rb
+++ b/app/models/like.rb
@@ -18,18 +18,6 @@ class Like
     id
   end
 
-  def self.like(note_id, auth = nil)
-
-    #1) Look up the like for the note
-    #2) Determine if this is a Like or an Un-Like
-    #3) Write the update
-
-  end
-
-  def like(note_id, auth)
-    self.class.like(note_id, auth)
-  end
-
   def self.find(user_id, auth = nil)
     response = YvApi.get('likes/items', user_id: user_id ) do |e|   # anonymous
       YvApi.get('likes/items', user_id: user_id, auth: auth) do |e| # auth'ed
@@ -38,7 +26,9 @@ class Like
       end
     end
 
-    build_objects(response.likes, auth)
+    #TODO: Add code to find the object in the collection returned in 'response'
+
+    #build_objects(response.likes, auth)
   end
 
   def find(user_id, auth)
@@ -69,6 +59,12 @@ class Like
     response
   end
 
+  def update(id, value, auth)
+
+
+
+  end
+
   def destroy
     response = YvApi.post('likes/delete', class_attributes(:note_id, :auth)) do |errors|
       @errors = errors.map { |e| e["error"] }
diff --git a/app/models/user.rb b/app/models/user.rb
index 733b611..01fad77 100644
--- a/app/models/user.rb
+++ b/app/models/user.rb
@@ -65,7 +65,11 @@ class User
   def notes
     Note.for_user(self.id, self.auth)
   end
-  
+
+  def likes
+    Like.find(id, auth)
+  end
+
   def create
     @token = Digest::MD5.hexdigest "#{@username}.Yv6-#{@password}"
     @secure = true
diff --git a/config/routes.rb b/config/routes.rb
index 7ddd9b5..79d6f3e 100644
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -4,6 +4,7 @@ YouversionWeb::Application.routes.draw do
   match 'bible(/:reference)' => 'references#show', :as => 'bible', :constraints => {:reference => /.*/}
   resources 'versions', :only => [:index, :show]
   resources 'notes'
+  match 'notes/like' => 'notes#like',    :as => 'like', :via => :put
 
   # Users
   resources 'users', :except => [:new, :create] do
-- 
1.7.0.4

